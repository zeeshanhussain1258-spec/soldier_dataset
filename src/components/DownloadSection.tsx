import React from 'react';
import { Download, FileText, BarChart3, Shield, Zap } from 'lucide-react';
import { saveAs } from 'file-saver';
import { AnalysisResults } from '../types/soldier';

interface DownloadSectionProps {
  results: AnalysisResults;
}

export const DownloadSection: React.FC<DownloadSectionProps> = ({ results }) => {
  const downloadCSV = () => {
    const csvContent = [
      'soldier_id,timestamp,heart_rate_bpm,resp_rate_bpm,spo2_pct,body_temp_c,latitude,longitude,climate_zone,health_status,predicted_fitness,fitness_probability,recommended_climate',
      ...results.processedData.map(row => [
        row.soldier_id,
        row.timestamp,
        row.heart_rate_bpm,
        row.resp_rate_bpm,
        row.spo2_pct,
        row.body_temp_c,
        row.latitude,
        row.longitude,
        row.climate_zone,
        row.health_status,
        row.predicted_fitness,
        row.fitness_probability,
        row.recommended_climate
      ].join(','))
    ].join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
    saveAs(blob, 'soldier_analysis_results.csv');
  };

  const downloadSummaryReport = () => {
    const reportContent = `
SOLDIER HEALTH MONITORING SYSTEM - ANALYSIS REPORT
Generated: ${new Date().toLocaleString()}

SUMMARY STATISTICS
==================
Total Soldiers Analyzed: ${results.summary.totalSoldiers}
Fit for Duty: ${results.summary.fitSoldiers} (${((results.summary.fitSoldiers / results.summary.totalSoldiers) * 100).toFixed(1)}%)
Unfit for Duty: ${results.summary.unfitSoldiers} (${((results.summary.unfitSoldiers / results.summary.totalSoldiers) * 100).toFixed(1)}%)
Critical Cases: ${results.summary.criticalCases} (${((results.summary.criticalCases / results.summary.totalSoldiers) * 100).toFixed(1)}%)

HEALTH STATUS BREAKDOWN
=======================
${Object.entries(results.summary.healthStatusDistribution)
  .map(([status, count]) => `${status.replace(/_/g, ' ')}: ${count} soldiers`)
  .join('\n')}

CLIMATE ZONE DISTRIBUTION
=========================
${Object.entries(results.summary.climateDistribution)
  .map(([zone, count]) => `${zone.replace(/_/g, ' ')}: ${count} soldiers`)
  .join('\n')}

RECOMMENDATIONS
===============
- Monitor critical cases closely and consider immediate medical evaluation
- Soldiers marked as "Relocate" should be considered for climate-appropriate deployment
- Continue regular health monitoring for all personnel
- Review environmental conditions for soldiers in heat stress categories

This report was generated by the AI-powered Soldier Health Monitoring System.
    `.trim();

    const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
    saveAs(blob, 'soldier_health_report.txt');
  };

  return (
    <div className="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-military-200 relative overflow-hidden">
      {/* Background Pattern */}
      <div className="absolute inset-0 bg-military-pattern opacity-5" />
      
      <div className="relative">
        <div className="flex items-center space-x-3 mb-6">
          <Shield className="w-6 h-6 text-military-600" />
          <h3 className="text-xl font-bold text-military-900">Mission Reports & Data Export</h3>
        </div>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <button
          onClick={downloadCSV}
          className="group flex items-center space-x-4 p-6 border-2 border-military-300 rounded-xl hover:bg-military-50 hover:border-military-500 transition-all duration-300 hover:scale-105 hover:shadow-lg"
        >
          <div className="p-3 bg-military-100 rounded-xl group-hover:bg-military-200 transition-colors duration-300">
            <FileText className="w-6 h-6 text-military-600 group-hover:text-military-700" />
          </div>
          <div className="text-left">
            <h4 className="font-bold text-military-900 group-hover:text-military-800 transition-colors duration-300">
              Download CSV Data
            </h4>
            <p className="text-sm text-military-600 mt-1">
              Complete analysis results with all metrics and predictions
            </p>
            <div className="flex items-center space-x-2 mt-2">
              <Zap className="w-3 h-3 text-tactical-500" />
              <span className="text-xs text-tactical-600 font-medium">Ready for further analysis</span>
            </div>
          </div>
          <Download className="w-5 h-5 text-military-400 group-hover:text-military-600 transition-colors duration-300 group-hover:animate-bounce-subtle" />
        </button>

        <button
          onClick={downloadSummaryReport}
          className="group flex items-center space-x-4 p-6 border-2 border-tactical-300 rounded-xl hover:bg-tactical-50 hover:border-tactical-500 transition-all duration-300 hover:scale-105 hover:shadow-lg"
        >
          <div className="p-3 bg-tactical-100 rounded-xl group-hover:bg-tactical-200 transition-colors duration-300">
            <BarChart3 className="w-6 h-6 text-tactical-600 group-hover:text-tactical-700" />
          </div>
          <div className="text-left">
            <h4 className="font-bold text-military-900 group-hover:text-military-800 transition-colors duration-300">
              Download Summary Report
            </h4>
            <p className="text-sm text-military-600 mt-1">
              Executive summary with key insights and recommendations
            </p>
            <div className="flex items-center space-x-2 mt-2">
              <Shield className="w-3 h-3 text-tactical-500" />
              <span className="text-xs text-tactical-600 font-medium">Command briefing ready</span>
            </div>
          </div>
          <Download className="w-5 h-5 text-tactical-400 group-hover:text-tactical-600 transition-colors duration-300 group-hover:animate-bounce-subtle" />
        </button>
        </div>
      </div>
    </div>
  );
};